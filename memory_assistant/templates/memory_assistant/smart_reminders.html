{% extends 'memory_assistant/base.html' %}
{% load static %}

{% block title %}Smart Reminders - Memora{% endblock %}

{% block content %}
<style>
/* Modern Header */
.modern-header {
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    margin-bottom: 2rem;
    overflow: hidden;
}

.header-content {
    padding: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.header-title {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
}

.header-title i {
    font-size: 2rem;
    color: var(--primary-color);
    margin-top: 0.25rem;
}

.header-title h2 {
    margin: 0;
    font-weight: 700;
    color: var(--text-dark);
}

.header-title p {
    margin: 0.25rem 0 0;
    color: var(--text-light);
    font-size: 0.95rem;
}

/* Active Reminders */
.active-reminders {
    margin-bottom: 2rem;
}

.section-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.section-header i {
    color: #f59e0b;
    font-size: 1.5rem;
}

.section-header h3 {
    margin: 0;
    font-weight: 600;
    color: var(--text-dark);
}

/* Reminders Grid */
.reminders-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

/* Reminder Cards */
.reminder-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    overflow: hidden;
    transition: all 0.3s ease;
}

.reminder-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.12);
}

.reminder-card.active {
    border: 2px solid #f59e0b;
    background: rgba(245, 158, 11, 0.05);
}

.reminder-header {
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.reminder-type {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    font-weight: 500;
}

.reminder-type i {
    color: var(--primary-color);
}

.reminder-priority {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    background: rgba(99, 102, 241, 0.1);
}

.reminder-priority.critical {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
}

.reminder-priority.high {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
}

.reminder-priority.medium {
    background: rgba(99, 102, 241, 0.1);
    color: var(--primary-color);
}

.reminder-priority.low {
    background: rgba(107, 114, 128, 0.1);
    color: #6b7280;
}

.reminder-content {
    padding: 1.25rem;
}

.reminder-content h4 {
    margin: 0 0 0.75rem;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-dark);
    line-height: 1.5;
}

.trigger-reason {
    margin: 0;
    color: var(--text-light);
    font-size: 0.9rem;
    line-height: 1.5;
}

.memory-link {
    text-decoration: none;
    color: inherit;
}

.memory-link:hover h4 {
    color: var(--primary-color);
}

.reminder-meta {
    margin-top: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-light);
    font-size: 0.85rem;
}

.meta-item i {
    color: var(--primary-color);
    font-size: 0.9rem;
}

.reminder-actions {
    padding: 1rem;
    display: flex;
    gap: 0.75rem;
    border-top: 1px solid rgba(0,0,0,0.05);
}

.btn-modern {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-radius: 12px;
    font-weight: 500;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    text-decoration: none;
    border: none;
    cursor: pointer;
    background: white;
    color: var(--text-dark);
    border: 2px solid rgba(0,0,0,0.1);
}

.btn-modern i {
    font-size: 1rem;
}

.btn-modern:hover {
    transform: translateY(-2px);
}

.btn-modern-success {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
    border-color: rgba(16, 185, 129, 0.2);
}

.btn-modern-success:hover {
    background: #10b981;
    color: white;
    border-color: #10b981;
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.25);
}

.btn-modern-warning {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
    border-color: rgba(245, 158, 11, 0.2);
}

.btn-modern-warning:hover {
    background: #f59e0b;
    color: white;
    border-color: #f59e0b;
    box-shadow: 0 4px 15px rgba(245, 158, 11, 0.25);
}

.btn-modern-danger {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    border-color: rgba(239, 68, 68, 0.2);
}

.btn-modern-danger:hover {
    background: #ef4444;
    color: white;
    border-color: #ef4444;
    box-shadow: 0 4px 15px rgba(239, 68, 68, 0.25);
}

/* Modern Card */
.modern-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    overflow: hidden;
}

.card-header {
    padding: 1.5rem;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.header-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.header-title i {
    color: var(--primary-color);
    font-size: 1.5rem;
}

.header-title h3 {
    margin: 0;
    font-weight: 600;
    color: var(--text-dark);
}

.header-title .count {
    color: var(--text-light);
    font-weight: normal;
}

.card-content {
    padding: 1.5rem;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-light);
}

.empty-state i {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
}

.empty-state h4 {
    margin: 0 0 0.5rem;
    color: var(--text-dark);
    font-weight: 600;
}

.empty-state p {
    margin: 0 0 1.5rem;
    font-size: 0.95rem;
}

/* Modern Modal */
.modern-modal {
    border-radius: 20px;
    overflow: hidden;
}

.modern-modal .modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.modern-modal .modal-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.modern-modal .modal-title i {
    color: var(--primary-color);
    font-size: 1.5rem;
}

.modern-modal .modal-title h4 {
    margin: 0;
    font-weight: 600;
    color: var(--text-dark);
}

.modern-modal .modal-description {
    margin: 0 0 1.5rem;
    color: var(--text-light);
    font-size: 0.95rem;
}

.snooze-options {
    display: grid;
    gap: 1rem;
}

.snooze-option {
    position: relative;
}

.snooze-option input[type="radio"] {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
}

.snooze-option label {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border-radius: 12px;
    border: 2px solid rgba(99, 102, 241, 0.1);
    cursor: pointer;
    transition: all 0.3s ease;
}

.snooze-option input[type="radio"]:checked + label {
    border-color: var(--primary-color);
    background: rgba(99, 102, 241, 0.05);
}

.snooze-option label:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(99, 102, 241, 0.15);
}

.option-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: white;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary-color);
    font-size: 1.2rem;
    box-shadow: 0 2px 8px rgba(99, 102, 241, 0.15);
}

.option-text span {
    display: block;
    font-weight: 600;
    color: var(--text-dark);
}

.option-text small {
    color: var(--text-light);
    font-size: 0.85rem;
}

.modern-modal .modal-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid rgba(0,0,0,0.05);
}

/* Responsive Design */
@media (max-width: 768px) {
    .header-content {
        flex-direction: column;
        gap: 1rem;
        padding: 1.5rem;
    }

    .header-actions {
        width: 100%;
    }

    .header-actions .btn-modern {
        width: 100%;
        justify-content: center;
    }

    .reminders-grid {
        grid-template-columns: 1fr;
    }

    .reminder-meta {
        flex-direction: column;
    }

    .reminder-actions {
        flex-direction: column;
    }

    .reminder-actions .btn-modern {
        width: 100%;
        justify-content: center;
    }
}

@media (max-width: 480px) {
    .reminder-actions {
        padding: 1rem;
    }

    .btn-modern {
        padding: 0.75rem;
        font-size: 0.85rem;
    }
}
</style>
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <!-- Modern Header -->
            <div class="modern-header">
                <div class="header-content">
                    <div class="header-title">
                        <i class="bi bi-bell"></i>
                        <div>
                            <h2>Smart Reminders</h2>
                            <p>Manage your AI-powered memory reminders</p>
                        </div>
                    </div>
                    <div class="header-actions">
                        <a href="{% url 'memory_assistant:dashboard' %}" class="btn-modern btn-modern-outline">
                            <i class="bi bi-arrow-left"></i>
                            <span>Back to Dashboard</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- Triggered Reminders -->
            {% if triggered_reminders %}
            <div class="active-reminders">
                <div class="section-header">
                    <i class="bi bi-exclamation-triangle"></i>
                    <h3>Active Reminders</h3>
                </div>
                <div class="reminders-grid">
                    {% for item in triggered_reminders %}
                    <div class="reminder-card active">
                        <div class="reminder-header">
                            <div class="reminder-type">
                                <i class="bi bi-bell-fill"></i>
                                <span>Active</span>
                            </div>
                            <div class="reminder-priority critical">
                                <i class="bi bi-exclamation-circle"></i>
                                <span>Needs Attention</span>
                            </div>
                        </div>
                        <div class="reminder-content">
                            <h4>{{ item.reminder.memory.content|truncatechars:100 }}</h4>
                            <p class="trigger-reason">{{ item.trigger.trigger_reason }}</p>
                        </div>
                        <div class="reminder-actions">
                            <button class="btn-modern btn-modern-success" onclick="markAsDone({{ item.reminder.id }})" title="Mark as Done">
                                <i class="bi bi-check-lg"></i>
                                <span>Done</span>
                            </button>
                            <button class="btn-modern btn-modern-warning" onclick="snoozeReminder({{ item.reminder.id }})" title="Snooze">
                                <i class="bi bi-clock"></i>
                                <span>Snooze</span>
                            </button>
                            <button class="btn-modern btn-modern-danger" onclick="dismissReminder({{ item.reminder.id }})" title="Decline">
                                <i class="bi bi-x-lg"></i>
                                <span>Decline</span>
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- All Reminders -->
            <div class="modern-card">
                <div class="card-header">
                    <div class="header-title">
                        <i class="bi bi-list-check"></i>
                        <h3>All Reminders <span class="count">({{ reminders.count }})</span></h3>
                    </div>
                </div>
                <div class="card-content">
                    {% if reminders %}
                    <div class="reminders-grid">
                        {% for reminder in reminders %}
                        <div class="reminder-card">
                            <div class="reminder-header">
                                <div class="reminder-type">
                                    <i class="bi bi-clock-history"></i>
                                    <span>{{ reminder.get_reminder_type_display }}</span>
                                </div>
                                <div class="reminder-priority {{ reminder.priority }}">
                                    <i class="bi bi-flag-fill"></i>
                                    <span>{{ reminder.priority|title }}</span>
                                </div>
                            </div>
                            <div class="reminder-content">
                                <a href="{% url 'memory_assistant:memory_detail' reminder.memory.id %}" class="memory-link">
                                    <h4>{{ reminder.memory.content|truncatechars:100 }}</h4>
                                </a>
                                <div class="reminder-meta">
                                    <div class="meta-item">
                                        <i class="bi bi-calendar-event"></i>
                                        <span>Next: {% if reminder.next_trigger %}
                                            {{ reminder.next_trigger|date:"M j, Y H:i" }}
                                        {% else %}
                                            Not scheduled
                                        {% endif %}</span>
                                    </div>
                                    <div class="meta-item">
                                        <i class="bi bi-clock-history"></i>
                                        <span>Last: {% if reminder.last_triggered %}
                                            {{ reminder.last_triggered|date:"M j, Y H:i" }}
                                        {% else %}
                                            Never
                                        {% endif %}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="reminder-actions">
                                <button class="btn-modern btn-modern-success" onclick="markAsDone({{ reminder.id }})" title="Mark as Done">
                                    <i class="bi bi-check-lg"></i>
                                    <span>Done</span>
                                </button>
                                <button class="btn-modern btn-modern-warning" onclick="snoozeReminder({{ reminder.id }})" title="Snooze">
                                    <i class="bi bi-clock"></i>
                                    <span>Snooze</span>
                                </button>
                                <button class="btn-modern btn-modern-danger" onclick="dismissReminder({{ reminder.id }})" title="Decline">
                                    <i class="bi bi-x-lg"></i>
                                    <span>Decline</span>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="bi bi-bell-slash"></i>
                        <h4>No smart reminders yet</h4>
                        <p>Create your first smart reminder by visiting a memory and using the AI suggestions!</p>
                        <a href="{% url 'memory_assistant:memory_list' %}" class="btn-modern btn-modern-primary">
                            <i class="bi bi-list"></i>
                            <span>View Memories</span>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Snooze Modal -->
<div class="modal fade" id="snoozeModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content modern-modal">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="bi bi-clock"></i>
                    <h4>Snooze Reminder</h4>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="modal-description">How long would you like to snooze this reminder?</p>
                <div class="snooze-options">
                    <div class="snooze-option">
                        <input type="radio" name="snoozeHours" id="snooze1" value="1" checked>
                        <label for="snooze1">
                            <div class="option-icon">
                                <i class="bi bi-hourglass-split"></i>
                            </div>
                            <div class="option-text">
                                <span>1 Hour</span>
                                <small>Remind me in an hour</small>
                            </div>
                        </label>
                    </div>
                    
                    <div class="snooze-option">
                        <input type="radio" name="snoozeHours" id="snooze3" value="3">
                        <label for="snooze3">
                            <div class="option-icon">
                                <i class="bi bi-clock"></i>
                            </div>
                            <div class="option-text">
                                <span>3 Hours</span>
                                <small>Remind me later today</small>
                            </div>
                        </label>
                    </div>
                    
                    <div class="snooze-option">
                        <input type="radio" name="snoozeHours" id="snooze6" value="6">
                        <label for="snooze6">
                            <div class="option-icon">
                                <i class="bi bi-alarm"></i>
                            </div>
                            <div class="option-text">
                                <span>6 Hours</span>
                                <small>Remind me this evening</small>
                            </div>
                        </label>
                    </div>
                    
                    <div class="snooze-option">
                        <input type="radio" name="snoozeHours" id="snooze24" value="24">
                        <label for="snooze24">
                            <div class="option-icon">
                                <i class="bi bi-calendar-event"></i>
                            </div>
                            <div class="option-text">
                                <span>1 Day</span>
                                <small>Remind me tomorrow</small>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-modern btn-modern-outline" data-bs-dismiss="modal">
                    <i class="bi bi-x"></i>
                    <span>Cancel</span>
                </button>
                <button type="button" class="btn-modern btn-modern-primary" onclick="confirmSnooze()">
                    <i class="bi bi-check"></i>
                    <span>Confirm Snooze</span>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
let currentReminderId = null;

function dismissReminder(reminderId) {
    if (confirm('Are you sure you want to dismiss this reminder?')) {
        fetch(`/memora/reminders/${reminderId}/actions/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            body: `action=dismiss`
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error: ' + data.message);
            }
        });
    }
}

function snoozeReminder(reminderId) {
    currentReminderId = reminderId;
    new bootstrap.Modal(document.getElementById('snoozeModal')).show();
}

function confirmSnooze() {
    const hours = document.querySelector('input[name="snoozeHours"]:checked').value;
    
    fetch(`/memora/reminders/${currentReminderId}/actions/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: `action=snooze&hours=${hours}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Error: ' + data.message);
        }
    });
    
    bootstrap.Modal.getInstance(document.getElementById('snoozeModal')).hide();
}

function markAsDone(reminderId) {
    // For now, just dismiss the reminder
    dismissReminder(reminderId);
}
</script>

{% csrf_token %}
{% endblock %}

