{% extends 'memory_assistant/base.html' %}

{% block title %}AI Dashboard - Memora{% endblock %}

{% block extra_css %}
<style>
    :root {
        --gradient-purple: linear-gradient(135deg, #7C3AED 0%, #6D28D9 100%);
        --gradient-purple-medium: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
        --gradient-purple-light: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%);
        --gradient-purple-pink: linear-gradient(135deg, #C084FC 0%, #A78BFA 100%);
        --gradient-orange: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
        --gradient-teal: linear-gradient(135deg, #0ea5e9 0%, #22d3ee 100%);
        --gradient-green: linear-gradient(135deg, #10b981 0%, #34d399 100%);
    }
    
    .hover-shadow {
        transition: all 0.3s ease;
    }
    .hover-shadow:hover {
        transform: translateY(-2px);
        box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important;
    }
    .hover-lift {
        transition: all 0.3s ease;
    }
    .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 1rem 2rem rgba(0,0,0,.15)!important;
    }
    .bg-gradient {
        background-image: linear-gradient(45deg, rgba(255,255,255,0.15) 0%, rgba(255,255,255,0) 100%);
    }
    .gradient-purple {
        background-image: var(--gradient-purple);
    }
    .gradient-purple-medium {
        background-image: var(--gradient-purple-medium);
    }
    .gradient-purple-light {
        background-image: var(--gradient-purple-light);
    }
    .gradient-purple-pink {
        background-image: var(--gradient-purple-pink);
    }
    .gradient-orange {
        background-image: var(--gradient-orange);
    }
    .gradient-teal {
        background-image: var(--gradient-teal);
    }
    .gradient-green {
        background-image: var(--gradient-green);
    }
    .text-gradient-purple {
        background: var(--gradient-purple);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .card {
        transition: all 0.3s ease;
        border-radius: 15px;
        overflow: hidden;
    }
    .card-header {
        border-radius: 15px 15px 0 0 !important;
    }
    .rounded-circle {
        transition: all 0.3s ease;
    }
    .card:hover .rounded-circle {
        transform: scale(1.1);
    }
    .btn {
        transition: all 0.3s ease;
    }
    .btn:hover {
        transform: translateY(-2px);
    }
    .btn-gradient-purple {
        background-image: var(--gradient-purple);
        border: none;
        color: white;
    }
    .btn-gradient-green {
        background-image: var(--gradient-green);
        border: none;
        color: white;
    }
    .btn-gradient-teal {
        background-image: var(--gradient-teal);
        border: none;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Stats Overview Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card h-100 gradient-purple">
                <div class="card-body d-flex flex-column align-items-center justify-content-center">
                    <div class="display-4 mb-2 text-white">{{ total_memories|default:"0" }}</div>
                    <div class="text-center text-white">
                        <i class="fas fa-archive mb-2" style="font-size: 1.5rem;"></i>
                        <div>Total Memories</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 gradient-purple-medium">
                <div class="card-body d-flex flex-column align-items-center justify-content-center">
                    <div class="display-4 mb-2 text-white">{{ important_memories|default:"0" }}</div>
                    <div class="text-center text-white">
                        <i class="fas fa-star mb-2" style="font-size: 1.5rem;"></i>
                        <div>Important Memories</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 gradient-purple-light">
                <div class="card-body d-flex flex-column align-items-center justify-content-center">
                    <div class="display-4 mb-2 text-white">{{ scheduled_memories_count|default:"0" }}</div>
                    <div class="text-center text-white">
                        <i class="fas fa-calendar mb-2" style="font-size: 1.5rem;"></i>
                        <div>Scheduled Memories</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card h-100 gradient-purple-pink">
                <div class="card-body d-flex flex-column align-items-center justify-content-center">
                    <div class="display-4 mb-2 text-white">{{ todays_memories_count|default:"0" }}</div>
                    <div class="text-center text-white">
                        <i class="fas fa-check-circle mb-2" style="font-size: 1.5rem;"></i>
                        <div>Today Memories</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <h1 class="mb-4 d-flex align-items-center">
                <i class="fas fa-brain me-3" style="color: #6c5ce7;"></i>
                <span>AI-Powered Dashboard</span>
            </h1>
            
            {% if not ai_enabled %}
                <div class="alert alert-warning shadow-sm border-0">
                    <h4><i class="fas fa-exclamation-triangle me-2"></i> AI Features Disabled</h4>
                    <p>To enable AI-powered memory processing, summarization, and smart suggestions, please set up your OpenAI API key.</p>
                    <p>Create a <code>.env</code> file in the project root with:</p>
                    <pre class="bg-light p-3 rounded"><code>OPENAI_API_KEY=your_api_key_here</code></pre>
                    <p><a href="https://platform.openai.com/api-keys" target="_blank" class="btn btn-primary rounded-pill">
                        <i class="fas fa-key me-2"></i>Get OpenAI API Key
                    </a></p>
                </div>
            {% else %}
                <!-- AI Analysis Section -->
                <div class="card mb-4 shadow-sm border-0">
                    <div class="card-header gradient-purple">
                        <h5 class="mb-0 text-white"><i class="fas fa-chart-line me-2"></i> AI Analysis</h5>
                    </div>
                    <div class="card-body">
                        {% if analysis %}
                            <div class="row">
                                <div class="col-md-8">
                                    <h6 class="text-gradient-purple mb-3">
                                        <i class="fas fa-brain me-2"></i>
                                        Productivity Insights
                                    </h6>
                                    <div class="p-3 bg-light rounded">
                                        <p class="mb-0">{{ analysis.analysis }}</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center p-4 rounded gradient-purple bg-opacity-10">
                                        <h3 class="text-white">{{ analysis.memory_count }}</h3>
                                        <p class="text-white mb-0 opacity-75">Total Memories</p>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-chart-bar fa-3x mb-3 text-gradient-purple"></i>
                                <p class="text-muted mb-0">No analysis available yet. Create more memories to get insights!</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- AI Suggestions Section -->
                <div class="card mb-4 shadow-sm border-0">
                    <div class="card-header gradient-green">
                        <h5 class="mb-0 text-white"><i class="fas fa-lightbulb me-2"></i> AI Suggestions</h5>
                    </div>
                    <div class="card-body">
                        {% if suggestions %}
                            <h6 class="mb-3" style="color: #10b981;">
                                <i class="fas fa-list-ul me-2"></i>
                                Suggested Topics to Remember
                            </h6>
                            <div class="row g-3">
                                {% for suggestion in suggestions %}
                                    <div class="col-md-6">
                                        <div class="card h-100 border-0 shadow-sm hover-shadow">
                                            <div class="card-body">
                                                <p class="mb-3">{{ suggestion }}</p>
                                                <button class="btn btn-sm btn-gradient-green rounded-pill w-100" 
                                                        onclick="createMemoryFromSuggestion('{{ suggestion }}')">
                                                    <i class="fas fa-plus me-2"></i> Create Memory
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-magic fa-3x mb-3" style="color: #10b981;"></i>
                                <p class="text-muted mb-0">No suggestions available yet. Create more memories to get personalized suggestions!</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- AI Tools Section -->
                <div class="card shadow-sm border-0">
                    <div class="card-header gradient-teal">
                        <h5 class="mb-0 text-white"><i class="fas fa-tools me-2"></i> AI Tools</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card h-100 border-0 shadow-sm hover-lift">
                                    <div class="card-body text-center p-4">
                                        <div class="rounded-circle gradient-purple p-3 d-inline-block mb-3">
                                            <i class="fas fa-magic fa-2x text-white"></i>
                                        </div>
                                        <h6 class="mb-3 text-gradient-purple">Memory Enhancement</h6>
                                        <p class="text-muted mb-4">Get AI suggestions to improve your memories and make them more meaningful</p>
                                        <button class="btn btn-gradient-purple rounded-pill w-100" onclick="showEnhancementTool()">
                                            <i class="fas fa-wand-magic-sparkles me-2"></i> Enhance Memory
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card h-100 border-0 shadow-sm hover-lift">
                                    <div class="card-body text-center p-4">
                                        <div class="rounded-circle gradient-teal p-3 d-inline-block mb-3">
                                            <i class="fas fa-tags fa-2x text-white"></i>
                                        </div>
                                        <h6 class="mb-3" style="color: #0ea5e9;">Auto-Categorization</h6>
                                        <p class="text-muted mb-4">Let AI automatically organize and categorize your memories</p>
                                        <button class="btn btn-gradient-teal rounded-pill w-100" onclick="showCategorizationTool()">
                                            <i class="fas fa-tag me-2"></i> Auto-Categorize
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Enhancement Modal -->
<div class="modal fade" id="enhancementModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content border-0 shadow">
            <div class="modal-header gradient-purple text-white">
                <h5 class="modal-title"><i class="fas fa-magic me-2"></i> Memory Enhancement</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="mb-4">
                    <label for="memoryContent" class="form-label text-gradient-purple">Memory Content</label>
                    <textarea class="form-control border-0 shadow-sm" id="memoryContent" rows="4" placeholder="Enter your memory content..."></textarea>
                </div>
                <button class="btn btn-gradient-purple rounded-pill" onclick="enhanceMemory()">
                    <i class="fas fa-magic me-2"></i> Enhance with AI
                </button>
                <div id="enhancementResults" class="mt-4" style="display: none;">
                    <h6 class="text-gradient-purple mb-3">AI Suggestions:</h6>
                    <div id="enhancementText" class="p-3 rounded shadow-sm" style="background: linear-gradient(135deg, rgba(99,102,241,0.1) 0%, rgba(168,85,247,0.1) 100%);"></div>
                    <h6 class="text-gradient-purple mb-3 mt-4">Suggested Categories:</h6>
                    <div id="suggestedCategories" class="mb-3"></div>
                    <h6 class="text-gradient-purple mb-3">Suggested Tags:</h6>
                    <div id="suggestedTags" class="mb-3"></div>
                    <h6 class="text-gradient-purple mb-3">Summary:</h6>
                    <div id="memorySummary" class="p-3 rounded shadow-sm bg-light"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Categorization Modal -->
<div class="modal fade" id="categorizationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content border-0 shadow">
            <div class="modal-header gradient-teal text-white">
                <h5 class="modal-title"><i class="fas fa-tags me-2"></i> Auto-Categorization</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="mb-4">
                    <label for="categorizeContent" class="form-label" style="color: #0ea5e9;">Memory Content</label>
                    <textarea class="form-control border-0 shadow-sm" id="categorizeContent" rows="4" placeholder="Enter your memory content..."></textarea>
                </div>
                <button class="btn btn-gradient-teal rounded-pill" onclick="categorizeMemory()">
                    <i class="fas fa-tag me-2"></i> Categorize with AI
                </button>
                <div id="categorizationResults" class="mt-4" style="display: none;">
                    <h6 style="color: #0ea5e9;" class="mb-3">Suggested Categories:</h6>
                    <div id="categoriesList" class="p-3 rounded shadow-sm" style="background: linear-gradient(135deg, rgba(14,165,233,0.1) 0%, rgba(34,211,238,0.1) 100%);"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showEnhancementTool() {
    $('#enhancementModal').modal('show');
}

function showCategorizationTool() {
    $('#categorizationModal').modal('show');
}

function enhanceMemory() {
    const content = document.getElementById('memoryContent').value;
    if (!content.trim()) {
        alert('Please enter some content to enhance.');
        return;
    }

    fetch('/memora/ai/enhance/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ content: content })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
        } else {
            document.getElementById('enhancementText').textContent = data.enhancement;
            document.getElementById('memorySummary').textContent = data.summary;
            
            // Display categories
            const categoriesDiv = document.getElementById('suggestedCategories');
            categoriesDiv.innerHTML = data.categories.map(cat => 
                `<span class="badge bg-primary me-1">${cat}</span>`
            ).join('');
            
            // Display tags
            const tagsDiv = document.getElementById('suggestedTags');
            tagsDiv.innerHTML = data.tags.map(tag => 
                `<span class="badge bg-secondary me-1">${tag}</span>`
            ).join('');
            
            document.getElementById('enhancementResults').style.display = 'block';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while enhancing the memory.');
    });
}

function categorizeMemory() {
    const content = document.getElementById('categorizeContent').value;
    if (!content.trim()) {
        alert('Please enter some content to categorize.');
        return;
    }

    fetch('/memora/ai/categorize/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ content: content })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
        } else {
            const categoriesDiv = document.getElementById('categoriesList');
            categoriesDiv.innerHTML = data.categories.map(cat => 
                `<span class="badge bg-primary me-1 mb-1">${cat}</span>`
            ).join('');
            document.getElementById('categorizationResults').style.display = 'block';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while categorizing the memory.');
    });
}

function createMemoryFromSuggestion(suggestion) {
    // Redirect to memory creation page with the suggestion
    window.location.href = `/memora/memories/create/?suggestion=${encodeURIComponent(suggestion)}`;
}
</script>
{% endblock %} 