{% extends 'memory_assistant/base.html' %}

{% block title %}AI Dashboard - Memora{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">
                <i class="fas fa-brain text-primary"></i>
                AI-Powered Dashboard
            </h1>
            
            {% if not ai_enabled %}
                <div class="alert alert-warning">
                    <h4><i class="fas fa-exclamation-triangle"></i> AI Features Disabled</h4>
                    <p>To enable AI-powered memory processing, summarization, and smart suggestions, please set up your OpenAI API key.</p>
                    <p>Create a <code>.env</code> file in the project root with:</p>
                    <pre><code>OPENAI_API_KEY=your_api_key_here</code></pre>
                    <p><a href="https://platform.openai.com/api-keys" target="_blank" class="btn btn-primary">Get OpenAI API Key</a></p>
                </div>
            {% else %}
                <!-- AI Analysis Section -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-line"></i> AI Analysis</h5>
                    </div>
                    <div class="card-body">
                        {% if analysis %}
                            <div class="row">
                                <div class="col-md-8">
                                    <h6>Productivity Insights</h6>
                                    <p>{{ analysis.analysis }}</p>
                                </div>
                                <div class="col-md-4">
                                    <div class="text-center">
                                        <h3 class="text-primary">{{ analysis.memory_count }}</h3>
                                        <p class="text-muted">Total Memories</p>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <p class="text-muted">No analysis available yet. Create more memories to get insights!</p>
                        {% endif %}
                    </div>
                </div>

                <!-- AI Suggestions Section -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5><i class="fas fa-lightbulb"></i> AI Suggestions</h5>
                    </div>
                    <div class="card-body">
                        {% if suggestions %}
                            <h6>Suggested Topics to Remember</h6>
                            <div class="row">
                                {% for suggestion in suggestions %}
                                    <div class="col-md-6 mb-2">
                                        <div class="card border-primary">
                                            <div class="card-body">
                                                <p class="mb-0">{{ suggestion }}</p>
                                                <button class="btn btn-sm btn-outline-primary mt-2" 
                                                        onclick="createMemoryFromSuggestion('{{ suggestion }}')">
                                                    <i class="fas fa-plus"></i> Create Memory
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <p class="text-muted">No suggestions available yet. Create more memories to get personalized suggestions!</p>
                        {% endif %}
                    </div>
                </div>

                <!-- AI Tools Section -->
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-tools"></i> AI Tools</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="card border-success">
                                    <div class="card-body">
                                        <h6><i class="fas fa-magic"></i> Memory Enhancement</h6>
                                        <p class="text-muted">Get AI suggestions to improve your memories</p>
                                        <button class="btn btn-success" onclick="showEnhancementTool()">
                                            <i class="fas fa-wand-magic-sparkles"></i> Enhance Memory
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="card border-info">
                                    <div class="card-body">
                                        <h6><i class="fas fa-tags"></i> Auto-Categorization</h6>
                                        <p class="text-muted">Automatically categorize your memories</p>
                                        <button class="btn btn-info" onclick="showCategorizationTool()">
                                            <i class="fas fa-tag"></i> Auto-Categorize
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Enhancement Modal -->
<div class="modal fade" id="enhancementModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-magic"></i> Memory Enhancement</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="memoryContent" class="form-label">Memory Content</label>
                    <textarea class="form-control" id="memoryContent" rows="4" placeholder="Enter your memory content..."></textarea>
                </div>
                <button class="btn btn-primary" onclick="enhanceMemory()">
                    <i class="fas fa-magic"></i> Enhance with AI
                </button>
                <div id="enhancementResults" class="mt-3" style="display: none;">
                    <h6>AI Suggestions:</h6>
                    <div id="enhancementText" class="alert alert-info"></div>
                    <h6>Suggested Categories:</h6>
                    <div id="suggestedCategories" class="mb-2"></div>
                    <h6>Suggested Tags:</h6>
                    <div id="suggestedTags" class="mb-2"></div>
                    <h6>Summary:</h6>
                    <div id="memorySummary" class="alert alert-secondary"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Categorization Modal -->
<div class="modal fade" id="categorizationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-tags"></i> Auto-Categorization</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="categorizeContent" class="form-label">Memory Content</label>
                    <textarea class="form-control" id="categorizeContent" rows="4" placeholder="Enter your memory content..."></textarea>
                </div>
                <button class="btn btn-info" onclick="categorizeMemory()">
                    <i class="fas fa-tag"></i> Categorize with AI
                </button>
                <div id="categorizationResults" class="mt-3" style="display: none;">
                    <h6>Suggested Categories:</h6>
                    <div id="categoriesList"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function showEnhancementTool() {
    $('#enhancementModal').modal('show');
}

function showCategorizationTool() {
    $('#categorizationModal').modal('show');
}

function enhanceMemory() {
    const content = document.getElementById('memoryContent').value;
    if (!content.trim()) {
        alert('Please enter some content to enhance.');
        return;
    }

    fetch('/memora/ai/enhance/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ content: content })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
        } else {
            document.getElementById('enhancementText').textContent = data.enhancement;
            document.getElementById('memorySummary').textContent = data.summary;
            
            // Display categories
            const categoriesDiv = document.getElementById('suggestedCategories');
            categoriesDiv.innerHTML = data.categories.map(cat => 
                `<span class="badge bg-primary me-1">${cat}</span>`
            ).join('');
            
            // Display tags
            const tagsDiv = document.getElementById('suggestedTags');
            tagsDiv.innerHTML = data.tags.map(tag => 
                `<span class="badge bg-secondary me-1">${tag}</span>`
            ).join('');
            
            document.getElementById('enhancementResults').style.display = 'block';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while enhancing the memory.');
    });
}

function categorizeMemory() {
    const content = document.getElementById('categorizeContent').value;
    if (!content.trim()) {
        alert('Please enter some content to categorize.');
        return;
    }

    fetch('/memora/ai/categorize/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ content: content })
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('Error: ' + data.error);
        } else {
            const categoriesDiv = document.getElementById('categoriesList');
            categoriesDiv.innerHTML = data.categories.map(cat => 
                `<span class="badge bg-primary me-1 mb-1">${cat}</span>`
            ).join('');
            document.getElementById('categorizationResults').style.display = 'block';
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while categorizing the memory.');
    });
}

function createMemoryFromSuggestion(suggestion) {
    // Redirect to memory creation page with the suggestion
    window.location.href = `/memora/memories/create/?suggestion=${encodeURIComponent(suggestion)}`;
}
</script>
{% endblock %} 